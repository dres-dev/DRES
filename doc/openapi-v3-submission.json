{
	"openapi": "3.0.1",
	"info": {
		"title": "DRES API - Submission",
		"description": "API for DRES (Distributed Retrieval Evaluation Server), Version 1.0",
		"version": "1.0"
	},
	"paths": {
		"/api/login": {
			"post": {
				"tags": ["User"],
				"summary": "Sets roles for session based on user account and returns a session cookie.",
				"operationId": "postApiLogin",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/LoginRequest"
							}
						}
					}
				},
				"responses": {
					"200": {
						"description": "OK",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/SuccessStatus"
								}
							}
						}
					},
					"400": {
						"description": "Bad Request",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ErrorStatus"
								}
							}
						}
					},
					"401": {
						"description": "Unauthorized",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ErrorStatus"
								}
							}
						}
					}
				}
			}
		},
		"/api/logout": {
			"get": {
				"tags": ["User"],
				"summary": "Clears all user roles of the current session.",
				"operationId": "getApiLogout",
				"responses": {
					"200": {
						"description": "OK",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/SuccessStatus"
								}
							}
						}
					},
					"400": {
						"description": "Bad Request",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ErrorStatus"
								}
							}
						}
					}
				}
			}
		},
		"/api/user/session": {
			"get": {
				"tags": ["User"],
				"summary": "Get current sessionId",
				"operationId": "getApiUserSession",
				"responses": {
					"200": {
						"description": "OK",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/SessionId"
								}
							}
						}
					},
					"500": {
						"description": "Server Error",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ErrorStatus"
								}
							}
						}
					}
				}
			}
		},
		"/log/query": {
			"post": {
				"tags": ["Log"],
				"summary": "Accepts query logs from participants",
				"operationId": "postLogQuery",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/QueryEventLog"
							}
						}
					}
				},
				"responses": {
					"200": {
						"description": "OK",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/SuccessStatus"
								}
							}
						}
					},
					"400": {
						"description": "Bad Request",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ErrorStatus"
								}
							}
						}
					},
					"401": {
						"description": "Unauthorized",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ErrorStatus"
								}
							}
						}
					}
				}
			}
		},
		"/log/result": {
			"post": {
				"tags": ["Log"],
				"summary": "Accepts result logs from participants",
				"operationId": "postLogResult",
				"requestBody": {
					"content": {
						"application/json": {
							"schema": {
								"$ref": "#/components/schemas/QueryResultLog"
							}
						}
					}
				},
				"responses": {
					"200": {
						"description": "OK",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/SuccessStatus"
								}
							}
						}
					},
					"400": {
						"description": "Bad Request",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ErrorStatus"
								}
							}
						}
					},
					"401": {
						"description": "Unauthorized",
						"content": {
							"application/json": {
								"schema": {
									"$ref": "#/components/schemas/ErrorStatus"
								}
							}
						}
					}
				}
			}
		}
	},
	"components": {
		"schemas": {
			"LoginRequest": {
				"required": ["password", "username"],
				"type": "object",
				"properties": {
					"username": {
						"type": "string"
					},
					"password": {
						"type": "string"
					}
				}
			},
			"SuccessStatus": {
				"required": ["description", "status"],
				"type": "object",
				"properties": {
					"description": {
						"type": "string"
					},
					"status": {
						"type": "boolean"
					}
				}
			},
			"ErrorStatus": {
				"required": ["description", "status"],
				"type": "object",
				"properties": {
					"description": {
						"type": "string"
					},
					"status": {
						"type": "boolean"
					}
				}
			},
			"UserDetails": {
				"required": ["id", "role", "username"],
				"type": "object",
				"properties": {
					"id": {
						"type": "string"
					},
					"username": {
						"type": "string"
					},
					"role": {
						"type": "string",
						"enum": ["ADMIN", "JUDGE", "VIEWER", "PARTICIPANT"]
					},
					"sessionId": {
						"type": "string"
					}
				}
			},
			"UserRequest": {
				"required": ["username"],
				"type": "object",
				"properties": {
					"username": {
						"type": "string"
					},
					"password": {
						"type": "string"
					},
					"role": {
						"type": "string",
						"enum": ["ADMIN", "JUDGE", "VIEWER", "PARTICIPANT"]
					}
				}
			},
			"SessionId": {
				"required": ["sessionId"],
				"type": "object",
				"properties": {
					"sessionId": {
						"type": "string"
					}
				}
			},
			"RestMediaCollection": {
				"required": ["id", "name"],
				"type": "object",
				"properties": {
					"id": {
						"type": "string"
					},
					"name": {
						"type": "string"
					},
					"description": {
						"type": "string"
					},
					"basePath": {
						"type": "string"
					}
				}
			},
			"RestFullMediaCollection": {
				"required": ["collection", "items"],
				"type": "object",
				"properties": {
					"collection": {
						"$ref": "#/components/schemas/RestMediaCollection"
					},
					"items": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/RestMediaItem"
						}
					}
				}
			},
			"RestMediaItem": {
				"required": ["collectionId", "id", "location", "name", "type"],
				"type": "object",
				"properties": {
					"id": {
						"type": "string"
					},
					"name": {
						"type": "string"
					},
					"type": {
						"type": "string",
						"enum": ["IMAGE", "VIDEO"]
					},
					"collectionId": {
						"type": "string"
					},
					"location": {
						"type": "string"
					},
					"durationMs": {
						"type": "integer",
						"format": "int64"
					},
					"fps": {
						"type": "number",
						"format": "float"
					}
				}
			},
			"CompetitionOverview": {
				"required": ["description", "id", "name", "taskCount", "teamCount"],
				"type": "object",
				"properties": {
					"id": {
						"type": "string"
					},
					"name": {
						"type": "string"
					},
					"description": {
						"type": "string"
					},
					"taskCount": {
						"type": "integer",
						"format": "int32"
					},
					"teamCount": {
						"type": "integer",
						"format": "int32"
					}
				}
			},
			"CompetitionCreate": {
				"required": ["description", "name", "participantsCanView"],
				"type": "object",
				"properties": {
					"name": {
						"type": "string"
					},
					"description": {
						"type": "string"
					},
					"participantsCanView": {
						"type": "boolean"
					}
				}
			},
			"RestCompetitionDescription": {
				"required": ["id", "name", "participantCanView", "taskGroups", "taskTypes", "tasks", "teams"],
				"type": "object",
				"properties": {
					"id": {
						"type": "string"
					},
					"name": {
						"type": "string"
					},
					"description": {
						"type": "string"
					},
					"taskTypes": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/TaskType"
						}
					},
					"taskGroups": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/TaskGroup"
						}
					},
					"tasks": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/RestTaskDescription"
						}
					},
					"teams": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/RestTeam"
						}
					},
					"participantCanView": {
						"type": "boolean"
					}
				}
			},
			"RestTaskDescription": {
				"required": ["components", "duration", "id", "mediaCollectionId", "name", "target", "taskGroup", "taskType"],
				"type": "object",
				"properties": {
					"id": {
						"type": "string"
					},
					"name": {
						"type": "string"
					},
					"taskGroup": {
						"type": "string"
					},
					"taskType": {
						"type": "string"
					},
					"duration": {
						"type": "integer",
						"format": "int64"
					},
					"mediaCollectionId": {
						"type": "string"
					},
					"target": {
						"$ref": "#/components/schemas/RestTaskDescriptionTarget"
					},
					"components": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/RestTaskDescriptionComponent"
						}
					}
				}
			},
			"RestTaskDescriptionComponent": {
				"required": ["type"],
				"type": "object",
				"properties": {
					"type": {
						"type": "string",
						"enum": ["IMAGE_ITEM", "VIDEO_ITEM_SEGMENT", "TEXT", "EXTERNAL_IMAGE", "EXTERNAL_VIDEO"]
					},
					"start": {
						"type": "integer",
						"format": "int64"
					},
					"end": {
						"type": "integer",
						"format": "int64"
					},
					"description": {
						"type": "string"
					},
					"path": {
						"type": "string"
					},
					"dataType": {
						"type": "string"
					},
					"mediaItem": {
						"type": "string"
					},
					"range": {
						"$ref": "#/components/schemas/TemporalRange"
					}
				}
			},
			"RestTaskDescriptionTarget": {
				"required": ["mediaItems", "type"],
				"type": "object",
				"properties": {
					"type": {
						"type": "string",
						"enum": ["SINGLE_MEDIA_ITEM", "SINGLE_MEDIA_SEGMENT", "MULTIPLE_MEDIA_ITEMS", "JUDGEMENT"]
					},
					"mediaItems": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/RestTaskDescriptionTargetItem"
						}
					}
				}
			},
			"RestTaskDescriptionTargetItem": {
				"required": ["mediaItem"],
				"type": "object",
				"properties": {
					"mediaItem": {
						"type": "string"
					},
					"temporalRange": {
						"$ref": "#/components/schemas/TemporalRange"
					}
				}
			},
			"RestTeam": {
				"required": ["color", "logo", "name", "users"],
				"type": "object",
				"properties": {
					"name": {
						"type": "string"
					},
					"color": {
						"type": "string"
					},
					"logo": {
						"type": "string"
					},
					"users": {
						"type": "array",
						"items": {
							"type": "string"
						}
					}
				}
			},
			"TaskGroup": {
				"required": ["name", "type"],
				"type": "object",
				"properties": {
					"name": {
						"type": "string"
					},
					"type": {
						"type": "string"
					}
				}
			},
			"TaskType": {
				"required": ["components", "filter", "name", "options", "score", "targetType", "taskDuration"],
				"type": "object",
				"properties": {
					"name": {
						"type": "string"
					},
					"taskDuration": {
						"type": "integer",
						"format": "int64"
					},
					"targetType": {
						"type": "string",
						"enum": ["SINGLE_MEDIA_ITEM", "SINGLE_MEDIA_SEGMENT", "MULTIPLE_MEDIA_ITEMS", "JUDGEMENT"]
					},
					"components": {
						"uniqueItems": true,
						"type": "array",
						"items": {
							"type": "string",
							"enum": ["IMAGE_ITEM", "VIDEO_ITEM_SEGMENT", "TEXT", "EXTERNAL_IMAGE", "EXTERNAL_VIDEO"]
						}
					},
					"score": {
						"type": "string",
						"enum": ["KIS", "AVS"]
					},
					"filter": {
						"uniqueItems": true,
						"type": "array",
						"items": {
							"type": "string",
							"enum": ["NO_DUPLICATES", "ONE_CORRECT_PER_TEAM", "TEMPORAL_SUBMISSION"]
						}
					},
					"options": {
						"uniqueItems": true,
						"type": "array",
						"items": {
							"type": "string",
							"enum": ["HIDDEN_RESULTS", "MAP_TO_SEGMENT"]
						}
					}
				}
			},
			"TemporalPoint": {
				"required": ["unit", "value"],
				"type": "object",
				"properties": {
					"value": {
						"type": "number",
						"format": "double"
					},
					"unit": {
						"type": "string",
						"enum": ["FRAME_NUMBER", "SECONDS", "MILLISECONDS"]
					}
				}
			},
			"TemporalRange": {
				"required": ["end", "start"],
				"type": "object",
				"properties": {
					"start": {
						"$ref": "#/components/schemas/TemporalPoint"
					},
					"end": {
						"$ref": "#/components/schemas/TemporalPoint"
					}
				}
			},
			"Team": {
				"required": ["color", "logo", "name", "users"],
				"type": "object",
				"properties": {
					"name": {
						"type": "string"
					},
					"color": {
						"type": "string"
					},
					"logo": {
						"type": "string"
					},
					"users": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/UID"
						}
					}
				}
			},
			"UID": {
				"required": ["string"],
				"type": "object",
				"properties": {
					"string": {
						"type": "string"
					}
				}
			},
			"RestDetailedTeam": {
				"required": ["color", "logo", "name", "users"],
				"type": "object",
				"properties": {
					"name": {
						"type": "string"
					},
					"color": {
						"type": "string"
					},
					"logo": {
						"type": "string"
					},
					"users": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/UserDetails"
						}
					}
				}
			},
			"RunInfo": {
				"required": ["competitionId", "id", "name", "participantsCanView", "tasks", "teams"],
				"type": "object",
				"properties": {
					"id": {
						"type": "string"
					},
					"name": {
						"type": "string"
					},
					"description": {
						"type": "string"
					},
					"teams": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/TeamInfo"
						}
					},
					"tasks": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/TaskInfo"
						}
					},
					"competitionId": {
						"type": "string"
					},
					"participantsCanView": {
						"type": "boolean"
					}
				}
			},
			"TaskInfo": {
				"required": ["duration", "name", "taskGroup"],
				"type": "object",
				"properties": {
					"name": {
						"type": "string"
					},
					"taskGroup": {
						"$ref": "#/components/schemas/TaskGroup"
					},
					"duration": {
						"type": "integer",
						"format": "int64"
					}
				}
			},
			"TeamInfo": {
				"required": ["color", "logo", "name"],
				"type": "object",
				"properties": {
					"name": {
						"type": "string"
					},
					"color": {
						"type": "string"
					},
					"logo": {
						"type": "string"
					}
				}
			},
			"RunState": {
				"required": ["id", "status", "timeLeft"],
				"type": "object",
				"properties": {
					"id": {
						"type": "string"
					},
					"status": {
						"type": "string",
						"enum": ["CREATED", "ACTIVE", "PREPARING_TASK", "RUNNING_TASK", "TASK_ENDED", "TERMINATED"]
					},
					"currentTask": {
						"$ref": "#/components/schemas/TaskInfo"
					},
					"timeLeft": {
						"type": "integer",
						"format": "int64"
					}
				}
			},
			"Score": {
				"required": ["score", "teamId"],
				"type": "object",
				"properties": {
					"teamId": {
						"type": "integer",
						"format": "int32"
					},
					"score": {
						"type": "number",
						"format": "double"
					}
				}
			},
			"ScoreOverview": {
				"required": ["name", "scores"],
				"type": "object",
				"properties": {
					"name": {
						"type": "string"
					},
					"taskGroup": {
						"type": "string"
					},
					"scores": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/Score"
						}
					}
				}
			},
			"ContentElement": {
				"required": ["contentType", "offset"],
				"type": "object",
				"properties": {
					"contentType": {
						"type": "string",
						"enum": ["TEXT", "VIDEO", "IMAGE"]
					},
					"content": {
						"type": "string"
					},
					"offset": {
						"type": "integer",
						"format": "int64"
					}
				}
			},
			"TaskHint": {
				"required": ["loop", "sequence", "taskId"],
				"type": "object",
				"properties": {
					"taskId": {
						"type": "string"
					},
					"sequence": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/ContentElement"
						}
					},
					"loop": {
						"type": "boolean"
					}
				}
			},
			"TaskTarget": {
				"required": ["sequence", "taskId"],
				"type": "object",
				"properties": {
					"taskId": {
						"type": "string"
					},
					"sequence": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/ContentElement"
						}
					}
				}
			},
			"SubmissionInfo": {
				"required": ["member", "status", "team", "timestamp"],
				"type": "object",
				"properties": {
					"team": {
						"type": "integer",
						"format": "int32"
					},
					"member": {
						"type": "string"
					},
					"status": {
						"type": "string",
						"enum": ["CORRECT", "WRONG", "INDETERMINATE", "UNDECIDABLE"]
					},
					"timestamp": {
						"type": "integer",
						"format": "int64"
					},
					"id": {
						"type": "string"
					},
					"item": {
						"$ref": "#/components/schemas/RestMediaItem"
					},
					"start": {
						"type": "integer",
						"format": "int64"
					},
					"end": {
						"type": "integer",
						"format": "int64"
					}
				}
			},
			"CompetitionStartMessage": {
				"required": ["competitionId", "name", "scoreboards", "type"],
				"type": "object",
				"properties": {
					"competitionId": {
						"type": "string"
					},
					"name": {
						"type": "string"
					},
					"type": {
						"type": "string",
						"enum": ["SYNCHRONOUS", "ASYNCHRONOUS"]
					},
					"scoreboards": {
						"type": "array",
						"items": {
							"type": "string"
						}
					}
				}
			},
			"ViewerInfo": {
				"required": ["host", "ready", "username", "viewersId"],
				"type": "object",
				"properties": {
					"viewersId": {
						"type": "string"
					},
					"username": {
						"type": "string"
					},
					"host": {
						"type": "string"
					},
					"ready": {
						"type": "boolean"
					}
				}
			},
			"JudgementRequest": {
				"required": ["collection", "item", "taskDescription", "token", "validator"],
				"type": "object",
				"properties": {
					"token": {
						"type": "string"
					},
					"validator": {
						"type": "string"
					},
					"collection": {
						"type": "string"
					},
					"item": {
						"type": "string"
					},
					"taskDescription": {
						"type": "string"
					},
					"startTime": {
						"type": "string"
					},
					"endTime": {
						"type": "string"
					}
				}
			},
			"Judgement": {
				"required": ["token", "validator", "verdict"],
				"type": "object",
				"properties": {
					"token": {
						"type": "string"
					},
					"validator": {
						"type": "string"
					},
					"verdict": {
						"type": "string",
						"enum": ["CORRECT", "WRONG", "INDETERMINATE", "UNDECIDABLE"]
					}
				}
			},
			"JudgementValidatorStatus": {
				"required": ["open", "pending", "validator"],
				"type": "object",
				"properties": {
					"validator": {
						"type": "string"
					},
					"pending": {
						"type": "integer",
						"format": "int32"
					},
					"open": {
						"type": "integer",
						"format": "int32"
					}
				}
			},
			"QueryEvent": {
				"required": ["category", "timestamp", "type", "value"],
				"type": "object",
				"properties": {
					"timestamp": {
						"type": "integer",
						"format": "int64"
					},
					"category": {
						"type": "string"
					},
					"type": {
						"type": "array",
						"items": {
							"type": "string"
						}
					},
					"value": {
						"type": "string"
					}
				}
			},
			"QueryEventLog": {
				"required": ["events", "serverTimeStamp$backend", "timestamp", "type"],
				"type": "object",
				"properties": {
					"timestamp": {
						"type": "integer",
						"format": "int64"
					},
					"events": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/QueryEvent"
						}
					},
					"type": {
						"type": "string"
					},
					"serverTimeStamp": {
						"type": "integer",
						"format": "int64",
						"writeOnly": true
					},
					"serverTimeStamp$backend": {
						"type": "integer",
						"format": "int64"
					}
				}
			},
			"QueryResult": {
				"required": ["video"],
				"type": "object",
				"properties": {
					"video": {
						"type": "string"
					},
					"shot": {
						"type": "integer",
						"format": "int32"
					},
					"frame": {
						"type": "integer",
						"format": "int32"
					},
					"score": {
						"type": "number",
						"format": "double"
					},
					"rank": {
						"type": "integer",
						"format": "int32"
					}
				}
			},
			"QueryResultLog": {
				"required": ["resultSetAvailability", "results", "serverTimeStamp$backend", "sortType", "timestamp", "usedCategories", "usedTypes", "values"],
				"type": "object",
				"properties": {
					"timestamp": {
						"type": "integer",
						"format": "int64"
					},
					"values": {
						"type": "array",
						"items": {
							"type": "string"
						}
					},
					"usedCategories": {
						"type": "array",
						"items": {
							"type": "string"
						}
					},
					"usedTypes": {
						"type": "array",
						"items": {
							"type": "string"
						}
					},
					"sortType": {
						"type": "array",
						"items": {
							"type": "string"
						}
					},
					"resultSetAvailability": {
						"type": "string"
					},
					"results": {
						"type": "array",
						"items": {
							"$ref": "#/components/schemas/QueryResult"
						}
					},
					"serverTimeStamp": {
						"type": "integer",
						"format": "int64",
						"writeOnly": true
					},
					"serverTimeStamp$backend": {
						"type": "integer",
						"format": "int64"
					}
				}
			}
		}
	}
}